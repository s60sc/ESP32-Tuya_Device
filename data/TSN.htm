
<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TuyaSniffer</title>
    <script src='/web?configs.js'></script>
    <STYLE type="text/css">
        th, td, p, input, button {
          font:20px 'Arial';
        }
        th, td {
          border-collapse: collapse;
          padding: 2px 3px;
          text-align: left;
        }
        table {
          border: 0px
        }
        th {
          font-weight:bold;
        }
        .button-group table{
          table-layout: fixed;
          width: 70%;
        }
        .button-group td {
          border: 0px
        }
        .settings_group td {
          border: solid 2px #ddd;
        }
        .fixWidth{
          width: 150px;
          display: inline-block;
        }
    </STYLE>
  </head>
  <body>
    <h2>Control & Monitor</h2>
    <h3>Press Config button to view or modify settings (changed values are not validated)</h3>
    <h3>Press Save button to make changes permanent</h3>
    <table id="button-group">
      <tr>
      <td><button class="fixWidth" onclick='getConfig("0")'>Config</button></td>
      <td><a href="/control?save=1"><button class="fixWidth">Save</button></a></td>
      <td><a href="/control?reset=1"><button class="fixWidth">Reboot ESP</button></a></td>
      <td><a href="/control?deldata=1"><button class="fixWidth">Reload Spiffs</button></a></td>
      <td><a href="/control?clear=1"><button class="fixWidth">Clear NVS</button></a></td>
      <td><a href="/web?OTA.htm"><button class="fixWidth">OTA Update</button></a></td>
      </tr>
    </table>
    <br/>
    <form onsubmit="return sendCmd()">
      <input style="width:90%;" placeholder="Enter command for device and press return" id='txtCmd'/> 
    </form>
    <pre id='log' style="height:90%;width:90%;border:5px solid #ccc;font:16px Arial;overflow:auto;"></pre>

    <script>
      // websocket handling
      var ip = document.location.host;
      var wsServer = "ws://" + ip + ":80/ws";
      var ws = new WebSocket(wsServer);

      add_log_line("Connect to: " + wsServer);
      connect();

      // add received line to log element
      function add_log_line(text) {
        var log = document.getElementById('log');
        var new_node = document.createTextNode(text + "\n");
        log.append(new_node);
      }

      // connect to websocket server
      function connect() {
        ws.onopen = function() {
          add_log_line("Connected");
        }
        ws.onmessage = function(messageEvent) {
          add_log_line(messageEvent.data);
        }
      }
      
      // send user command to websocket server
      function sendCmd() {
        var txt  = document.getElementById('txtCmd');
        var line = txt.value;
        if (line != "") {
          ws.send(line);
          add_log_line("CMD: " + line);
          txt.value = "";
          txt.focus();
        }
        return false;
      }
    </script>
  </body>
</html>
